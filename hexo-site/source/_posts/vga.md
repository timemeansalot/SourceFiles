---
title: VGAç¬”è®°
date: 2023-07-10 11:16:32
tags:
  - RISC-V
  - IP
password: opensource
---

VGA ç›¸å…³ç¬”è®°

![img](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTQyNjI0MC8yMDE4MDkvMTQyNjI0MC0yMDE4MDkyMjE2MzI1MTM0My0yMjkzOTAwNjkuanBn?x-oss-process=image/format,png)

<!--more-->

[TOC]

# VGAï¼ˆVideo Graphics Arrayï¼‰åŸºç¡€åŸç†

> å®é™…ä¸Šï¼Œæ“ä½œ VGA çš„è¿‡ç¨‹å°±æ˜¯ç»™ä½ ä¸€å—æœ‰æ¨ªçºµåæ ‡èŒƒå›´çš„åŒºåŸŸï¼ŒåŒºåŸŸä¸Šçš„æ¯ä¸€ä¸ªåæ ‡ç‚¹å°±æ˜¯ä¸€ä¸ªåƒç´ ç‚¹ï¼Œä½ å¯ä»¥åšçš„äº‹æƒ…æ˜¯**ç»™è¿™ä¸ªåƒç´ ç‚¹ç‰¹å®šçš„ rgb è‰²å½©**.

## å†å²èƒŒæ™¯

1.  IBM äº 1987 å¹´éš PS/2 æœºä¸€èµ·æ¨å‡ºçš„ä¸€ç§ä½¿ç”¨æ¨¡æ‹Ÿä¿¡å·çš„è§†é¢‘ä¼ è¾“æ ‡å‡†

2.  ä¸æ”¯æŒçƒ­æ’æ‹”ï¼Œä¸æ”¯æŒéŸ³é¢‘ä¼ è¾“

3.  ä¿¡å·ï¼šä¸‰åŸè‰²ï¼ˆçº¢ç»¿è“ï¼‰ã€hsyncã€vsyn

4.  æ—¶åº

    ![VGAæ—¶åº](https://s2.loli.net/2023/07/13/bLzAfZvM8YgURuo.png)

    Hor Scan Time æ˜¯ä¸€ä¸ªæ‰«æå‘¨æœŸï¼Œå®ƒä¼šå…ˆæ‰«æåˆ° Hor Syncã€å†æ‰«æ Hor Back Porchï¼Œç„¶åæ‰è¿›å…¥æœ‰æ•ˆæ˜¾ç¤ºåŒº Hor Active Videoï¼Œæœ€åæ˜¯ä¸€æ®µ Hor Front Porchï¼›å¯ä»¥çœ‹å‡ºæ¥ï¼Œå››æ®µåŒºé—´åªæœ‰ Hor Active Video è¿™ä¸€æ®µæ˜¯èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºå›¾åƒä¿¡æ¯çš„ï¼Œä¹Ÿå°±æ˜¯å±å¹•ä¸Šæ˜¾ç¤ºçš„é‚£ä¸€å—åŒºé—´

    VGA çš„æ—¶åºå‚æ•°è·Ÿ**åˆ†è¾¨ç‡**ä»¥åŠ**åˆ·æ–°é¢‘ç‡**æœ‰å…³

    - åˆ†è¾¨ç‡

      ![image-20230711113651677](https://s2.loli.net/2023/07/13/F8OE2iUr74nHxuK.png)

    - åˆ·æ–°é¢‘ç‡ï¼šè¡Œæ‰«æå‘¨æœŸ _ åœºæ‰«æå‘¨æœŸ _ åˆ·æ–°é¢‘ç‡ = æ—¶é’Ÿé¢‘ç‡

           640x480@60ï¼š
           è¡Œæ‰«æå‘¨æœŸï¼š800(åƒç´ )ï¼Œåœºæ‰«æå‘¨æœŸï¼š525(è¡Œæ‰«æå‘¨æœŸ) åˆ·æ–°é¢‘ç‡ï¼š60Hz
           800 _ 525 _ 60 = 25,200,000 â‰ˆ 25.175MHz ï¼ˆè¯¯å·®å¿½ç•¥ä¸è®¡ï¼‰
           640x480@75ï¼š
           è¡Œæ‰«æå‘¨æœŸï¼š840(åƒç´ ) åœºæ‰«æå‘¨æœŸï¼š500(è¡Œæ‰«æå‘¨æœŸ) åˆ·æ–°é¢‘ç‡ï¼š75Hz
           840 _ 500 _ 75 = 31,500,000 = 31.5MHz

           ![VESA and Industry Standards and Guidelines

      for Computer Display Monitor Timing (DMT)](https://s2.loli.net/2023/07/13/c5HDeym6pquUBYT.png)

5.  VGA åŸºç¡€çŸ¥è¯†

    1. ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…æ˜¯ï¼Œè™½ç„¶ä½ çœ‹åˆ°çš„å±å¹•å¤§å°æ˜¯ 640x480 çš„ï¼Œä½†æ˜¯å®ƒçš„å®é™…å¤§å°å¹¶ä¸åªæœ‰é‚£ä¹ˆç‚¹ï¼Œå½¢è±¡ä¸€ç‚¹å°±æ˜¯è¯´ï¼ŒVGA æ‰«æçš„èŒƒå›´æ˜¯åŒ…å«äº†ä½ èƒ½å¤Ÿçœ‹åˆ°çš„ 640x480 è¿™ä¸€å—åŒºåŸŸçš„æ›´å¤§åŒºåŸŸ
    2. VGA æ˜¾ç¤ºå™¨æ‰«ææ–¹å¼ä»å±å¹•å·¦ä¸Šè§’ä¸€ç‚¹å¼€å§‹ï¼Œä»å·¦å‘å³é€ç‚¹æ‰«æï¼Œæ¯æ‰«æå®Œä¸€è¡Œï¼Œç”µå­æŸå›åˆ°å±å¹•çš„å·¦è¾¹ä¸‹ä¸€è¡Œçš„èµ·å§‹ä½ç½®ï¼Œåœ¨è¿™æœŸé—´ï¼Œ**CRTï¼ˆé˜´æå°„çº¿ç®¡ï¼‰ å¯¹ç”µå­æŸè¿›è¡Œæ¶ˆéš**ï¼ˆå½“ç”µå­æªæ‰«æè¿‡äº†å³ä¾§æ²¡æœ‰è§å…‰ç²‰çš„åŒºåŸŸåï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°å›åˆ°æœ€å·¦ä¾§çš„å‘½ä»¤ï¼ˆè¡ŒåŒæ­¥ä¿¡å·è„‰å†²ï¼‰ä¹‹å‰ï¼Œç”µå­æªéœ€è¦å…³é—­ä»¥å®ç°**æ¶ˆéš**ï¼‰ï¼Œæ¯è¡Œç»“æŸæ—¶ï¼Œç”¨è¡ŒåŒæ­¥ä¿¡å·è¿›è¡ŒåŒæ­¥
    3. å½“æ‰«æå®Œæ‰€æœ‰çš„è¡Œï¼Œ**å½¢æˆä¸€å¸§**ï¼Œç”¨åœºåŒæ­¥ä¿¡å·è¿›è¡ŒåœºåŒæ­¥ï¼Œå¹¶ä½¿æ‰«æå›åˆ°å±å¹•å·¦ä¸Šæ–¹
    4. å®Œæˆä¸€è¡Œæ‰«æçš„æ—¶é—´ç§°ä¸ºæ°´å¹³æ‰«ææ—¶é—´ï¼Œå…¶å€’æ•°ç§°ä¸ºè¡Œé¢‘ç‡ï¼›å®Œæˆä¸€å¸§ï¼ˆæ•´å±ï¼‰æ‰«æçš„æ—¶é—´ç§°ä¸ºå‚ç›´æ‰«ææ—¶é—´ï¼Œå…¶å€’æ•°ç§°ä¸ºåœºé¢‘ç‡ï¼Œå³å±å¹•çš„åˆ·æ–°é¢‘ç‡

    ![img](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTQyNjI0MC8yMDE4MDkvMTQyNjI0MC0yMDE4MDkyMjE2MzM0NTgxOC0xNzA0NjU5OTQucG5n?x-oss-process=image/format,png)

# VGA å¼€æºé¡¹ç›®

## [vga-clock](https://github.com/mattvenn/vga-clock)

> åœ¨ 640x480 VGA æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºæ—¶é—´çš„ç®€å•é¡¹ç›®

![image-20230712192126069](https://s2.loli.net/2023/07/13/lJLxqWwBAD49j2F.png)

åªå®ç°äº†**640x480**åˆ†è¾¨ç‡çš„ VGA Controllerï¼Œç„¶ååŸºäºè¯¥ VGA Controller å®ç°äº†*æ—¶é’Ÿæ˜¾ç¤ºçš„åº”ç”¨*

| è€ƒæ ¸æ ‡å‡†   |     |
| ---------- | --- |
| å¯è¯»æ€§     | 4   |
| å¯é…ç½®æ€§   | 2   |
| åŠŸèƒ½æ­£ç¡®æ€§ | 5   |
| æ˜“ç”¨æ€§     | 2   |

## [Miz702_VGA](https://gitee.com/fengshuaigit/Miz702_VGA)

> æ”¯æŒ 640\*480 åˆ†è¾¨ç‡ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºé™æ€å½©è‰²å›¾ç‰‡

å…¶ VGA æ§åˆ¶å™¨ç«¯å£å¦‚ä¸‹ï¼Œæ§åˆ¶å™¨ç«¯å£åˆ—è¡¨é‡Œä¸åŒ…æ‹¬å¾…æ˜¾ç¤ºçš„æ•°æ®ä¿¡å·ï¼Œä¸€å…±å¯ä»¥æ˜¾ç¤º 640x480 ä¸ªåƒç´ ç‚¹ï¼Œåƒç´ ç‚¹ä½ç½®ç”± pixel_x, pixel_y ç¡®å®š

```verilog
module vga_sync(
        input   wire            clk,
        input   wire            rst_n,
        output	wire		video_en,                  //æ•°æ®æœ‰æ•ˆ
        output  reg             hsync,                 //åœºåŒæ­¥ä¿¡å·
        output  reg             vsync,                 //è¡ŒåŒæ­¥ä¿¡å·
        output  wire    [9:0]   pixel_x,               //å¾…æ˜¾ç¤ºå¾…åƒç´ çš„xåæ ‡
        output  wire    [9:0]   pixel_y                //å¾…æ˜¾ç¤ºå¾…åƒç´ çš„yåæ ‡
);

endmodule
```

æµ‹è¯•æ–‡ä»¶çš„ç«¯å£å¦‚ä¸‹æ‰€ç¤ºï¼Œæµ‹è¯•æ–‡ä»¶ç«¯å£é‡Œä¸åŒ…å«åƒç´ ç‚¹çš„åæ ‡ä¿¡æ¯ï¼Œå› ä¸ºè¿æ¥åˆ°æ˜¾ç¤ºå™¨ä¹‹åï¼ŒVGA ä¿¡å·ä¼šè‡ªåŠ¨ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹åœ¨æ˜¾ç¤ºå™¨ä¸Šè¾“å‡ºæ˜¾ç¤ºï¼Œåœ¨ç¡®å®šäº†æ˜¾ç¤ºçš„åˆ†è¾¨ç‡è·Ÿé¢‘ç‡ä¹‹åï¼Œä¿¡å·è¾“å‡ºçš„ä½ç½®ç”±`hsync`è·Ÿ`vsync`ä¿¡å·ç¡®å®š

```verilog
module vga_test(
            input   wire            sys_clk,
            input   wire            sys_rst_n,
            output  wire            hsync,  // <-- VGA port 13
            output  wire            vsync,  // <-- VGA port 14
    		output  wire   [11:0]   rgb,    // <-- VGA port 1,2,3
		    output  reg	            led
);
endmodule
```

åœ¨æ˜¾ç¤ºå™¨ä¸Šè¾“å‡ºé™æ€å›¾ç‰‡çš„åŸç†ï¼š

- å°† 640x480 çš„é™æ€å›¾ç‰‡åˆ¶ä½œæˆ ceo æ–‡ä»¶
- åœ¨ vivado é‡Œå°†è¯¥ ceo æ–‡ä»¶åˆ›å»ºä¸ºä¸€ä¸ª ROM IP
- åœ¨ testbench é‡Œé¢è°ƒç”¨è¯¥ ROM IPï¼Œå®ç°æ•°æ®è¯»å–ã€‚å°†æ•°æ®è¯»å–åˆ°å¯„å­˜å™¨é‡Œ
- testbench è¾“å‡º rbg ä¿¡å·çš„æ—¶å€™ï¼Œå­˜å¯„å­˜å™¨é‡Œè¾“å‡ºä¿¡å·åˆ° rgb

é¡¹ç›®åˆ†æï¼ˆæ»¡åˆ† 5 åˆ†ï¼‰ï¼š

| è€ƒæ ¸æ ‡å‡†   |     |
| ---------- | --- |
| å¯è¯»æ€§     | 5   |
| å¯é…ç½®æ€§   | 2   |
| åŠŸèƒ½æ­£ç¡®æ€§ | 5   |
| æ˜“ç”¨æ€§     | 4   |

## [VGA åŸç†ä¸ FPGA å®ç°](https://blog.csdn.net/yifantan/article/details/126835530?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-5-126835530-blog-81840978.235^v38^pc_relevant_sort_base2&spm=1001.2101.3001.4242.4&utm_relevant_index=8)

> æ”¯æŒå¤šç§åˆ†è¾¨ç‡

å…¶ VGA Controller ç«¯å£å®šä¹‰å¦‚ä¸‹ï¼ŒController ç«¯å£é‡ŒåŒ…å«äº†æ•°æ®ä¿¡å·çš„è¾“å…¥ã€è¾“å‡º`Data`, `VGA_RGB`

```verilog
module VGA_CTRL(
    input Clk,
    input Reset_n,
    input [23:0]Data,
    output reg Data_Req,    //æ ¹æ®æ³¢å½¢è°ƒè¯•å¾—åˆ°
    output reg [9:0]hcount, //å½“å‰æ‰«æç‚¹çš„æœ‰æ•ˆå›¾ç‰‡Håæ ‡, ç”¨äºtestæ¨¡å—
    output reg [9:0]vcount, //å½“å‰æ‰«æç‚¹çš„æœ‰æ•ˆå›¾ç‰‡Våæ ‡, ç”¨äºtestæ¨¡å—
    output reg VGA_HS,
    output reg VGA_VS,
    output reg VGA_BLK,     //BLKè¡¨ç¤ºçš„å°±æ˜¯ è¾“å‡ºæœ‰æ•ˆå›¾ç‰‡ ä¿¡å·  é«˜ç”µå¹³æœ‰æ•ˆ
    output reg [23:0]VGA_RGB//  RGB888
    );
endmodule
```

æ‰€æœ‰æ”¯æŒçš„åˆ†è¾¨ç‡åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œå®šä¹‰ï¼Œé€šè¿‡å®çš„æ–¹å¼é€‰æ‹©æŸä¸€ä¸ªåˆ†è¾¨ç‡

```verilog
// `define Resolution_480x272 1	//åˆ·æ–°ç‡ä¸º60Hzæ—¶åƒç´ æ—¶é’Ÿä¸º9MHz
`define Resolution_640x480 1	//åˆ·æ–°ç‡ä¸º60Hzæ—¶åƒç´ æ—¶é’Ÿä¸º25.175MHz
// `define Resolution_800x480 1	//åˆ·æ–°ç‡ä¸º60Hzæ—¶åƒç´ æ—¶é’Ÿä¸º33MHz
//`define Resolution_800x600 1	//åˆ·æ–°ç‡ä¸º60Hzæ—¶åƒç´ æ—¶é’Ÿä¸º40MHz
//`define Resolution_1024x768 1	//åˆ·æ–°ç‡ä¸º60Hzæ—¶åƒç´ æ—¶é’Ÿä¸º65MHz
//`define Resolution_1280x720 1	//åˆ·æ–°ç‡ä¸º60Hzæ—¶åƒç´ æ—¶é’Ÿä¸º74.25MHz
//`define Resolution_1920x1080 1	//åˆ·æ–°ç‡ä¸º60Hzæ—¶åƒç´ æ—¶é’Ÿä¸º148.5MHz

`ifdef Resolution_480x272
    `define H_Right_Border 0
    `define H_Front_Porch 2
    `define H_Sync_Time 41
    `define H_Back_Porch 2
    `define H_Left_Border 0
    `define H_Data_Time 480
    `define H_Total_Time 525
    `define V_Bottom_Border 0
    `define V_Front_Porch 2
    `define V_Sync_Time 10
    `define V_Back_Porch 2
    `define V_Top_Border 0
    `define V_Data_Time 272
    `define V_Total_Time 286

`elsif Resolution_640x480
	`define H_Total_Time  12'd800
	`define H_Right_Border  12'd8
	`define H_Front_Porch  12'd8
	`define H_Sync_Time  12'd96
	`define H_Data_Time 12'd640
	`define H_Back_Porch  12'd40
	`define H_Left_Border  12'd8
	`define V_Total_Time  12'd525
	`define V_Bottom_Border  12'd8
	`define V_Front_Porch  12'd2
	`define V_Sync_Time  12'd2
	`define V_Data_Time 12'd480
	`define V_Back_Porch  12'd25
	`define V_Top_Border  12'd8

//......
```

åœ¨ VGA_CTRL æ¨¡å—é‡Œï¼Œè°ƒç”¨äº†å„ç§åˆ†è¾¨ç‡å¯¹åº”çš„å®ï¼Œä»è€Œæ”¯æŒå„ç§åˆ†è¾¨ç‡çš„ VGA

```verilog
    localparam Hsync_End = `H_Total_Time;
    localparam HS_End = `H_Sync_Time;
    localparam Hdat_Begin = `H_Sync_Time + `H_Back_Porch + `H_Left_Border;
    localparam Hdat_End = `H_Sync_Time + `H_Left_Border + `H_Back_Porch + `H_Data_Time;
    localparam Vsync_End = `V_Total_Time;
    localparam VS_End = `V_Sync_Time;
    localparam Vdat_Begin =  `V_Sync_Time + `V_Back_Porch + `V_Top_Border;
    localparam Vdat_End = `V_Sync_Time + `V_Back_Porch + `V_Top_Border + `V_Data_Time;
```

é¡¹ç›®åˆ†æï¼ˆæ»¡åˆ† 5 åˆ†ï¼‰ï¼š

| è€ƒæ ¸æ ‡å‡†   |     |
| ---------- | --- |
| å¯è¯»æ€§     | 5   |
| å¯é…ç½®æ€§   | 4   |
| åŠŸèƒ½æ­£ç¡®æ€§ | 5   |
| æ˜“ç”¨æ€§     | 4   |

![image-20230713110232004](https://s2.loli.net/2023/07/13/tYG5xCX3ypM6F8L.png)

![image-20230713110138494](https://s2.loli.net/2023/07/13/rHQUsAGiDJP6ujf.png)

## [vga_lcd](https://github.com/freecores/vga_lcd)

<img src="https://s2.loli.net/2023/07/13/NFyegRCiTvaLcnl.png" alt="image-20230713113742671" style="zoom: 25%;" />

è¯¥é¡¹ç›®æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. æ”¯æŒå¤šç§åˆ†è¾¨ç‡ã€è‡ªå®šä¹‰åˆ†è¾¨ç‡
2. æ”¯æŒå¤šç§é¢œè‰²æ·±åº¦ bpp
3. å®šä¹‰äº†è·Ÿ Host è¿›è¡Œæ•°æ®è¯»å–çš„æ¨¡å—
4. æ”¯æŒé¼ æ ‡æ¨¡å—

ä¸Šè¿°æ¶æ„å›¾ä¸­ï¼Œå„ä¸ªæ¨¡å—çš„åŠŸèƒ½å¦‚ä¸‹ï¼š

1. Cursor ç›¸å…³éƒ¨åˆ†

   - Cursor Base Registerï¼šå­˜å‚¨ Cursor åƒç´ ä¿¡æ¯çš„èµ·å§‹åœ°å€
   - Cursor Bufferï¼šä»å­˜å‚¨é‡Œè¯»å–å‡ºæ¥çš„ Cursor çš„ä¿¡æ¯ï¼Œå¯ä»¥å­˜å‚¨åœ¨è¯¥ Buffer ä¸­ï¼Œä»è€Œé¿å…æ¯æ¬¡éœ€è¦è®¿é—®å­˜å‚¨æ‰èƒ½å¾—åˆ° Cursor çš„åƒç´ ä¿¡æ¯ã€‚è¯¥ Buffer çš„å®¹é‡æ˜¯ 512x32bit
   - Cursor Processorï¼šè´Ÿè´£è®¡ç®—è·Ÿ Cursor ç›¸å…³çš„åƒç´ ç‚¹çš„ä½ç½®ã€é¢œè‰²ä¿¡æ¯ï¼Œéœ€è¦è·Ÿ VGA èƒŒæ™¯é¢œè‰²è¿›è¡Œé€‰æ‹©ï¼Œä»è€Œåœ¨å±å¹•ä¸Šå±•ç¤º Cursor

2. å›¾åƒç›¸å…³éƒ¨åˆ†

   - Line FiFoï¼šè¾“å…¥ RBG ä¿¡å·ï¼Œæ˜¯ä¸€ä¸ª ping pong memory çš„ç»“æ„ï¼Œä¿è¯äº†è¾“å‡ºåˆ° VGA å±å¹•çš„é¢œè‰²ä¿¡å·æºæºä¸æ–­ã€åŒæ—¶èµ·åˆ°æ—¶é’ŸåŸŸåˆ‡æ¢çš„ä½œç”¨
   - Color Processorï¼šå°†ä¸åŒæ·±åº¦çš„é¢œè‰²è½¬åŒ–ä¸º VGA å±å¹•å±•ç¤ºçš„ RGB ä¿¡æ¯ï¼Œå½“è¾“å…¥çš„é¢œè‰²ä¿¡æ¯æ˜¯ 32bit, 24 bit æ—¶ï¼Œç›´æ¥ pass through å³å¯ï¼›å½“è¾“å…¥é¢œè‰²ä¿¡æ¯æ˜¯ 16bit æ—¶ï¼Œå…¶ä¸­ 5bit å±•ç¤ºçº¢è‰²ã€6bit å±•ç¤ºç»¿è‰²ã€5bit å±•ç¤ºè“è‰²ï¼›å½“è¾“å…¥çš„é¢œè‰²æ˜¯ 8bit æ—¶ï¼Œé€šè¿‡å†…éƒ¨çš„ Color Lookup Table æ‰¾åˆ° RGB é¢œè‰²
   - Video Timing Generatorï¼šäº§ç”Ÿ VGA åŒæ­¥ä¿¡å·ï¼Œå¦‚`VSYNC, HSYNC`

3. æ•°æ®è®¿é—®ç›¸å…³

   - Video Memory Base Registerï¼šå­˜å‚¨å¤–éƒ¨ Video æ•°æ®çš„èµ·å§‹åœ°å€
   - Wishbone Master Interfaceï¼šColor Processor è·Ÿ Cursor Processor è®¿é—®å¤–éƒ¨å­˜å‚¨å™¨æ—¶ï¼Œé€šè¿‡è¯¥æ¥å£
   - Wishbone Slave Interfaceï¼šæ§åˆ¶ç”¨æˆ·å¯ä»¥è®¿é—®çš„å¯„å­˜å™¨çš„è®¿é—®

é¡¹ç›®åˆ†æï¼ˆæ»¡åˆ† 5 åˆ†ï¼‰ï¼š

| è€ƒæ ¸æ ‡å‡†   |     |
| ---------- | --- |
| å¯è¯»æ€§     | 3   |
| å¯é…ç½®æ€§   | 5   |
| åŠŸèƒ½æ­£ç¡®æ€§ | 5   |
| æ˜“ç”¨æ€§     | 3   |

# VGA é¡¹ç›®æ¯”è¾ƒ

å¦‚ä¸Šæ‰€è¿°ï¼Œ[vga-clock](https://github.com/mattvenn/vga-clock)ã€ [Miz702_VGA](https://gitee.com/fengshuaigit/Miz702_VGA)ä¸¤ä¸ªé¡¹ç›®éƒ½åªæ”¯æŒå›ºå®š 640x480 åˆ†è¾¨ç‡çš„ VGA æ¥å£ï¼Œå…¶ä¼˜ç‚¹åœ¨äºä»£ç è§„èŒƒã€æ¯”è¾ƒå®¹æ˜“ä¸Šæ‰‹ï¼›

[VGA åŸç†ä¸ FPGA å®ç°](https://blog.csdn.net/yifantan/article/details/126835530?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-5-126835530-blog-81840978.235^v38^pc_relevant_sort_base2&spm=1001.2101.3001.4242.4&utm_relevant_index=8)åˆ™æ”¯æŒå¤šç§åˆ†è¾¨ç‡æ¨¡å¼çš„ VGA æ¥å£ï¼Œå…¶åŸç†åœ¨äºé€šè¿‡é¢„å…ˆå®šä¹‰çš„å®æ¥æ”¯æŒå„ç§åˆ†è¾¨ç‡çš„ VGAï¼Œå¹¶ä¸”å…¶ VGA Controller æ¨¡å—ä¸­çš„ä¿¡å·åŒ…å«`hsync, vsync, RGB[23:0]` ç­‰ä¿¡å·ï¼Œå› æ­¤å…¶ VGA Controller çš„è¾“å‡ºå¯ä»¥ç›´æ¥é©±åŠ¨æ˜¾ç¤ºå™¨æ˜¾ç¤ºç”»é¢ï¼›

[vga_lcd](https://github.com/freecores/vga_lcd)æ”¯æŒå¤šç§åˆ†è¾¨ç‡æ¨¡å¼ã€å¤šç§è‰²æ·±æ¨¡å¼ï¼Œå…¶ä¸æ­¢æ˜¯ä¸€ä¸ª VGA æ§åˆ¶å™¨ï¼Œè¿˜æ”¯æŒé¼ æ ‡æ˜¾ç¤ºï¼›æ­¤å¤–è¯¥é¡¹ç›®è¿˜åŒ…å«äº† VGA æ¨¡å—è·Ÿå­˜å‚¨æ¨¡å—çš„äº¤äº’è®¾ç½®ï¼Œä¿è¯äº† VGA é¢œè‰²å¯ä»¥æºæºä¸æ–­åœ°è¾“å‡ºï¼Œä½†æ˜¯è¯¥é¡¹ç›®ä¹Ÿæ˜¯æœ€å¤æ‚çš„ã€‚

# VGA ç»†èŠ‚è®¾è®¡å’Œè®¾è®¡éš¾ç‚¹

![](https://s2.loli.net/2023/07/19/EAGOHLg6V2qbNTS.png)

VGA æ”¯æŒå¦‚ä¸‹ç‰¹æ€§ï¼š

1. å…¶åˆ†è¾¨ç‡æœ€é«˜ä¸º 640x480ï¼Œé¢œè‰²æ·±åº¦ä¸º 4 ä»¥èŠ‚çº¦è¾“å‡ºå¸¦å®½
2. å…¶åˆ†è¾¨ç‡æœ€é«˜ä¸º 640x480ï¼Œé¢œè‰²æ·±åº¦ä¸º 4 ä»¥èŠ‚çº¦æ•°æ®å­˜å‚¨ç©ºé—´

## VGA Ctrl æ¨¡å—çš„è¾“å…¥è¾“å‡ºä¿¡å·

| Port    | Width | Rirection | Description      |
| ------- | ----- | --------- | ---------------- |
| clk_p_i | 1     | Input     | Pixel Clock      |
| reset   | 1     | Input     | Reset Singal     |
| data_i  | 12    | Input     | Color Data Input |
| hsync_o | 1     | Output    | Horizontal Sync  |
| vsync_o | 1     | Output    | Vertical Sync    |
| blank_o | 1     | Output    | Blank Sync       |
| r_o     | 4     | Output    | Red Color Data   |
| g_o     | 4     | Output    | Green Color Data |
| b_o     | 4     | Output    | Blue Color Data  |
| v_addr  | 10    | Output    | Vertical index   |
| h_addr  | 9     | Output    | Horizontal index |

ä¿¡å·è¯´æ˜ï¼š

1. clk_p_i, reset: æ—¶é’Ÿä¿¡å·ï¼Œè·Ÿåƒç´ è¾“å‡ºæ‰€éœ€è¦çš„é¢‘ç‡æœ‰å…³ï¼›å¤ä½ä¿¡å·
2. data_iï¼šä»å†…å­˜é‡Œè¯»å–çš„é¢œè‰²ä¿¡å·ï¼Œä¸€å…± 12bitï¼Œæ¯ä¸ªé¢œè‰²å  4bit
3. r_o, g_o, b_oï¼šé¢œè‰²ä¿¡å·ï¼Œæ¯ä¸ªé¢œè‰²ä¿¡å·å  4 bitï¼Œè¾“å‡ºçš„é¢œè‰²ä¿¡å·ä¼šè¢«æ•°æ¨¡è½¬æ¢æ¨¡å—(DAC)è½¬åŒ–ä¸ºå¯¹åº”çš„æ¨¡æ‹Ÿä¿¡å·
4. hsync_o, vsync_oï¼šåŒæ­¥ä¿¡å·ã€ä½æœ‰æ•ˆï¼Œåˆ†åˆ«æ˜¯â€œæ°´å¹³åŒæ­¥â€ã€â€œå‚ç›´åŒæ­¥â€ï¼Œå„åŒæ­¥ä¿¡å·å¯¹äºå›¾åƒè¾“å‡ºçš„ä½œç”¨å¦‚ä¸‹å›¾æ‰€ç¤º

   ![](https://s2.loli.net/2023/07/19/5FxhmHw4ZItsuKG.png)

5. blank_oï¼šç©ºç™½ä¿¡å·ã€ä½æœ‰æ•ˆï¼Œè¯¥ä¿¡å·ä¸ºé«˜çš„æ—¶å€™ï¼Œè¡¨æ˜æ˜¾ç¤ºå™¨ä¸Šæ²¡æœ‰å›¾åƒæ˜¾ç¤ºï¼Œblank ä¿¡å·æœ‰æ•ˆæ—¶ï¼ŒDAC è¾“å‡ºçš„æ¨¡æ‹Ÿä¿¡å·ä¼šè¢«å¼ºåˆ¶æ‹‰ä½
6. v_addr, h_addrï¼šåƒç´ ç‚¹çš„åæ ‡ï¼Œè¯¥åæ ‡ä¸»è¦ç”¨äºä» Data Memory é‡Œé¢å»è¯»å–å¯¹åº”çš„åƒç´ ä¿¡æ¯ï¼Œæ¯æ¬¡ä» Data Memory é‡Œè¯»å– 12 bits æ•°æ®ï¼Œè¾“å…¥åˆ° VGA ä¸­

## å†…å­˜è®¡ç®—ç›¸å…³

640x480 çš„å±å¹•ï¼Œä¸€å¸§ç”»é¢éœ€è¦çš„å­˜å‚¨ä¸º MEMï¼Œåˆ™

$$
MEM = 640 * 480 * 12 = 3.51 MB
$$

> ä¸ºäº†ä¿è¯ VGA èƒ½å¤Ÿè¾“å‡ºè¿ç»­çš„ç”»é¢ï¼ŒVGA éœ€è¦è¾“å‡ºçš„ä¸€å¸§çš„è‰²å½©æ•°æ®ï¼Œéœ€è¦æå‰å†™å…¥åˆ° Memory ä¸­ï¼Œç„¶åä¾› VGA è¯»å–

1. é’ˆå¯¹ 640x480 çš„å±å¹•ï¼Œä»¤å…¶å­˜å‚¨ä¸º RAM ä¸€å…±æœ‰ 640*480=307200 è¡Œï¼Œæ¯ä¸€è¡Œå  12 bitï¼Œåœ¨æ•°æ®è¯»å–çš„æ—¶å€™ï¼Œ
   æ ¹æ®`index=h_addr*480+v_addr`ï¼Œå†ç”±è¯¥ index ä½œä¸ºç´¢å¼•å–å‡º 12bits çš„æ•°æ®
   **Question:**æ—¢ç„¶ VGA è¾“å‡ºä¿¡å·æ˜¯ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹é¡ºåºè¾“å‡ºçš„ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦èƒ½å¤Ÿåœ¨ä¸€å¸§ç”»é¢è¾“å‡ºå¼€å§‹ä¹‹åï¼Œé¡ºåºä» Data Memory é‡Œå–å‡ºæ•°æ®ç»™åˆ° VGAï¼Œä»è€Œä¸ç”¨ä½¿ç”¨åœ°å€è¿›è¡Œç´¢å¼•ï¼Ÿ

2. ä¸ºäº†ä¿è¯ Core å†™å…¥æ•°æ®åˆ° Data Memory è·Ÿ VGA ä» Data Memory æ•°æ®è¢« VGA è¯»å‡ºæ—¶äº’ä¸å¹²æ‰°ï¼ŒData Memory é‡‡ç”¨ Ping Pong Memory çš„ç»“æ„ï¼Œä¿è¯ä¸€è¯»ä¸€å†™ï¼› Data Memory å†…éƒ¨éœ€è¦ç»´æŠ¤è¯»å†™æ“ä½œ

## Optionalï¼šè°ƒèŠ‚è¾“å‡ºçš„åˆ†è¾¨ç‡

<u>åªéœ€è¦æŠŠåˆ·æ–°çš„ä¸Šç•Œçš„å€¼å­˜å‚¨åœ¨**å¯„å­˜å™¨**é‡Œï¼Œå°±å¯ä»¥æ”¯æŒä¸åŒçš„åˆ·æ–°ç‡è·Ÿåˆ†è¾¨ç‡äº†</u>ï¼Œ
å¦‚æœåªéœ€è¦å›ºå®šçš„ 640x480 åˆ†è¾¨ç‡ï¼Œåˆ™å¯ä»¥å°†ç›¸å…³å‚æ•°åœ¨ RTL ä»£ç é‡Œå†™æ­».

```verilog
  //640x480åˆ†è¾¨ç‡ä¸‹çš„VGAå‚æ•°è®¾ç½®
  parameter    h_frontporch = 96;
  parameter    h_active = 144;
  parameter    h_backporch = 784;
  parameter    h_total = 800;

  parameter    v_frontporch = 2;
  parameter    v_active = 35;
  parameter    v_backporch = 515;
  parameter    v_total = 525;
```

å¦‚ä¸Šæ‰€ç¤ºï¼ŒVGA è¾“å‡ºçš„ä¿¡å·éƒ½æ˜¯æœ‰ä¸Šè¿°ä¿¡å·æ¥è®¡ç®—äº§ç”Ÿçš„ï¼Œä¾‹å¦‚åŒæ­¥ä¿¡å·çš„è®¡ç®—å¦‚ä¸‹ï¼š

```verilog
  //ç”ŸæˆåŒæ­¥ä¿¡å·
  assign hsync = (x_cnt > h_frontporch);
  assign vsync = (y_cnt > v_frontporch);
```

åœ¨ä¸åŒçš„åˆ†è¾¨ç‡ä¸‹ä¸Šè¿°å‚æ•°æœ‰ä¸åŒçš„æ•°å€¼ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼›è‹¥ä¸Šè¿°å‚æ•°ä¸æ˜¯åœ¨ RTL ä»£ç é‡Œå›ºå®šå†™æ­»çš„ï¼Œè€Œæ˜¯é€šè¿‡å¯„å­˜å™¨é‡Œè¯»å‡ºï¼Œé‚£ä¹ˆ VGA æ¨¡å—åœ¨å®é™…è¿è¡Œçš„æ—¶å€™ï¼Œå°±å¯ä»¥æ”¯æŒè¾“å‡ºä¸åŒçš„åˆ†è¾¨ç‡ä»¥åŠé¢‘ç‡äº†ã€‚

![](https://s2.loli.net/2023/07/19/4kWq2lSJR7pvgao.png)

## éš¾ç‚¹åˆ†æ

1. Q: Core çš„æ—¶é’Ÿè·Ÿ VGA çš„æ—¶é’Ÿä¸åŒï¼Œéœ€è¦æ•°æ®æ—¶é’ŸåŸŸçš„åˆ‡æ¢ï¼›æ­¤å¤–ï¼Œèƒ½å¦ä¿è¯ Ping Pong Memory è·Ÿ VGA æ˜¯ä¸€ä¸ªæ—¶é’ŸåŸŸï¼Ÿ  
   Aï¼šç”±è®¾è®¡è€…å†³å®šä»¥åŠå®ç°
2. Qï¼šå¦‚ä½•æ­£ç¡®åœ°é€‰æ‹© VGA Data Memory çš„å®¹é‡ï¼Œæ‰å¯ä»¥ä¿è¯å…¶èƒ½å¤Ÿå®¹çº³ VGA ä¸€å¸§çš„ç”»é¢ã€å¹¶ä¸”ä¸ä¼šå æ®å¤ªå¤šå­˜å‚¨ç©ºé—´ï¼Ÿ  
   Aï¼šVGA memory è®¾è®¡éœ€è¦è·Ÿ SDRAM è®¾è®¡ååŒ
3. Qï¼šCore å¦‚ä½•å†™å…¥æ•°æ®åˆ° Data Memoryï¼Ÿæ˜¯é€šè¿‡ load/store æŒ‡ä»¤è¿˜æ˜¯é€šè¿‡ DMAï¼Ÿ  
   Aï¼šç›®å‰ Core ä¸æ”¯æŒ DMAï¼Œæ‰€ä»¥æ˜¯é€šè¿‡ load/store æ¥å®ç°å°†æ•°æ®å†™å…¥åˆ° SDRAMã€‚
4. Qï¼š å¦‚æœæˆ‘ä»¬é‡‡ç”¨å¯„å­˜å™¨çš„æ–¹å¼æ¥æ›´æ”¹ VGA è¾“å‡ºçš„åˆ†è¾¨ç‡ä»¥åŠé¢‘ç‡ï¼Œåˆ™æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¾€è¿™äº›é…ç½®å¯„å­˜å™¨é‡Œå†™å…¥æ•°æ®ï¼Ÿæ˜¯é€šè¿‡å¤„ç†å™¨å¾€ VGA é…ç½®å¯„å­˜å™¨é‡Œå†™å…¥å—ï¼Ÿ  
   Aï¼šç”± Core è´Ÿè´£å†™å…¥é…ç½®ä¿¡æ¯åˆ°å¯„å­˜å™¨ä¸­

# ğŸŒŸğŸŒŸğŸŒŸVGA è®¾è®¡ä¸å®ç° ğŸŒŸğŸŒŸğŸŒŸ

## æ¶æ„è®¾è®¡

![data flow](https://s2.loli.net/2023/07/27/edc2HSwg5iNuXsI.png)
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»SoCäº§ç”Ÿæ•°æ®åˆ°æ•°æ®é€šè¿‡VGAç°å®åœ¨å±å¹•ä¸Šï¼Œæ•°æ®éœ€è¦é¦–å…ˆè¢«å†™å…¥åˆ°SDRAMä¸­ï¼ŒVGAå†ä»SDRAMä¸­è¯»å–æ•°æ®ã€‚
ç”±äºéœ€è¦å¤„ç†å¥½**SDRAMçš„ç«äº‰é—®é¢˜**ï¼Œç»è¿‡è°ƒç ”å‘ç°å¦‚ä¸‹å‡ ç§å¸¸è§çš„è§£å†³æ–¹æ³•ï¼š

1. ä½¿ç”¨åŒç«¯å£SDRAM
   - ä¼˜ç‚¹ï¼šèƒ½å¤Ÿç›´æ¥æ”¯æŒCoreè·ŸVGAåŒæ—¶è®¿é—®SDRAM
   - ç¼ºç‚¹ï¼š
     1. åŒç«¯å£SDRAMçš„æˆæœ¬è·Ÿé¢ç§¯æ¯”å•ç«¯å£SDRAMå¤§
     2. å½“æœ‰å…¶ä»–è®¿é—®SDRAMçš„è®¾å¤‡åŠ å…¥æ—¶ï¼Œä¸é€‚ç”¨
2. å°†SDRAMçš„é¢‘ç‡æå‡è‡³Coreé¢‘ç‡çš„ä¸¤å€ï¼Œæ­¤æ—¶SDRAMä¸€åŠçš„æ—¶é—´å¯ä»¥ç”±Coreè®¿é—®ã€å¦ä¸€åŠçš„æ—¶é—´å¯ä»¥ç”±VGAè®¿é—®
   - ä¼˜ç‚¹ï¼šèƒ½å¤Ÿæ»¡è¶³Coreè·ŸVGAäº¤æ›¿è®¿é—®SDRAM
   - ç¼ºç‚¹ï¼š
     1. SDRAMé¢‘ç‡å¾ˆéš¾åšåˆ°Coreçš„ä¸¤å€
     2. å½“æœ‰å…¶ä»–è®¿é—®SDRAMçš„è®¾å¤‡åŠ å…¥æ—¶ï¼Œä¸é€‚ç”¨
3. æ€»çº¿+æ—¶åˆ†å¤ç”¨ï¼šç”±äºVGAè¾“å‡ºå­˜åœ¨blankæ—¶é—´ï¼Œæ­¤æ—¶ä¸éœ€è¦ç°å®æ•°æ®ï¼Œå› æ­¤blankæ—¶é—´å¯ä»¥è®©Coreè®¿é—®SDRAM
   - ä¼˜ç‚¹ï¼šå¯¹SDRAMæ²¡æœ‰é¢å¤–è¦æ±‚
   - ç¼ºç‚¹ï¼š
     1. éœ€è¦é¢å¤–æ§åˆ¶é“¾è·¯æ§åˆ¶Coreè·ŸVGAè®¿é—®SDRAM
     2. åœ¨VGAå¤„äºvisibleæ—¶é—´æ—¶ï¼ŒCoreæ— æ³•è®¿é—®SDRAMï¼Œå› æ­¤å¯èƒ½å¯¼è‡´Core Stall

![system](https://s2.loli.net/2023/07/26/BxZr9HknAaltCUd.png)
é€šè¿‡ä¸Šè¿°åˆ†æï¼Œä»¥åŠå¼€æºSDRAMè®¾è®¡ï¼Œæœ¬ç‰ˆVGAè·ŸSDRAMå’ŒCoreé€šè¿‡AXIæ€»çº¿é“¾æ¥ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶è®¾è®¡ç‰¹ç‚¹å¦‚ä¸‹ï¼š

1. é‡‡ç”¨åŒç«¯å£SDRAMä»¥å°½å¯èƒ½ä¿è¯VGAè®¿é—®SDRAMæ—¶ï¼ŒSDRAMä¸ä¼šè¢«å…¶ä»–è®¾å¤‡å ç”¨
2. Coreå†™å…¥SDRAMçš„ä¼˜å…ˆçº§é«˜äºVGAè®¿é—®ä¼˜å…ˆçº§ï¼Œä»è€Œä¿è¯Coreçš„æ‰§è¡Œ
3. VGAæ¨¡å—å†…éƒ¨æœ‰ping pong memoryä½œä¸ºframe bufferï¼ŒSDRAMé€šè¿‡Burstä¼ è¾“çš„æ–¹å¼å°†å¸§ç”»é¢å†™å…¥åˆ°frame buffer

![vga](https://s2.loli.net/2023/07/27/2Mqdg78YAphLjQI.png)
VGAæ¨¡å—å†…éƒ¨è®¾è®¡å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»è¦åˆ†ä¸º3å¤§æ¨¡å—ï¼Œå„æ¨¡å—åŠŸèƒ½å¦‚ä¸‹ï¼š

1. Frame Bufferï¼šæ˜¯ä¸€å—Ping Pong Memoryï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ç¼“å­˜ä¸€å¸§çš„ç”»é¢ï¼Œä»è€Œé¿å…VGAè®¿é—®SDRAMå¤±è´¥æ—¶ï¼Œè¾“å‡ºç”»é¢æ’•è£‚
2. Config Moduleï¼šé€šè¿‡AXIæ€»çº¿æ¥å—Coreå¯¹VGAçš„é…ç½®ä¿¡æ¯ï¼Œä»è€Œæ›´æ”¹VGAçš„è¾“å‡ºåˆ†è¾¨ç‡ä»¥åŠå¸§ç‡
3. VGA Ctrlï¼šè¿è¡ŒVGAè®¡ç®—ï¼Œè¾“å‡º444çš„RGBæ•°æ®ä»¥åŠåŒæ­¥ä¿¡å·

## é¡¶å±‚æ¥å£

> input and output design

- VGAçš„è¾“å…¥æ•°æ®ä¸»è¦æ¥è‡ªäºCoreçš„å¯„å­˜å™¨é…ç½®ä¿¡æ¯ï¼Œä»¥åŠä»SDRAMé‡Œè¯»å‡ºçš„å¸§ç”»é¢ä¿¡æ¯ï¼›
- VGAè¾“å‡ºæ•°æ®ä¸»è¦åŒ…æ‹¬RGBä¿¡å·ä»¥åŠåŒæ­¥ä¿¡å·ã€‚

### ä»SDRAMè¯»å–æ•°æ®çš„ä¿¡å·

> VGA çš„frame bufferä½œä¸ºAXIçš„master

| Signal  | Direction | Width | Description                                |
| ------- | --------- | ----- | ------------------------------------------ |
| arburst | Output    | 2     | burstä¼ è¾“ç±»å‹                              |
| araddr  | Output    | 32    | è¯»åœ°å€                                     |
| arlen   | Output    | 8     | bursyé•¿åº¦ï¼›è¡¨ç¤ºä¸€æ¬¡burstä¼ è¾“åŒ…å«çš„ä¼ è¾“æ¬¡æ•° |
| arsize  | Output    | 3     | è¡¨ç¤ºä¸€æ¬¡burstä¼ è¾“å†…æ¯æ¬¡ä¼ è¾“çš„size          |
| arready | Input     | 1     | å‡†å¤‡å¥½æ¥æ”¶è¯»åœ°å€                           |
| arvalid | Output    | 1     | è¯»åœ°å€æœ‰æ•ˆä¿¡å·                             |
| rdata   | Input     | 32    | è¯»æ•°æ®                                     |
| rresp   | Input     | 2     | è¯»æ“ä½œçŠ¶æ€                                 |
| rlast   | Input     | 1     | burstä¼ è¾“å†…çš„æœ€åä¸€ä¸ª                      |
| rready  | Output    | 1     | å‡†å¤‡å¥½äº†æ¥æ”¶è¯»æ•°æ®                         |
| rvalid  | Input     | 1     | è¯»æœ‰æ•ˆä¿¡å·                                 |

TODO: add clock signals

### Coreå†™å…¥åˆ°VGA å¯„å­˜å™¨çš„ä¿¡å·

> VGA configå•å…ƒä½œä¸ºAXIçš„Slave

| Signal  | Direction | Width | Description                                                      |
| ------- | --------- | ----- | ---------------------------------------------------------------- |
| awid    | Input     |       | å†™åœ°å€IDï¼Œç”¨æ¥æ ‡è¯†å†™æ“ä½œï¼Œç›¸åŒIDå†…å“åº”ä¸èƒ½ä¹±åºï¼›ä¸åŒIDé—´å¯ä»¥ä¹±åº |
| awburst | Input     | 2     | burstç±»å‹                                                        |
| awlen   | Input     | 8     | bursté•¿åº¦                                                        |
| awsize  | Input     | 3     | burstä¼ è¾“size                                                    |
| awready | Output    | 1     | slaveå‡†å¤‡å¥½æ¥æ”¶å†™åœ°å€                                            |
| awvalid | Input     | 1     | å†™åœ°å€æœ‰æ•ˆä¿¡å·                                                   |
| awaddr  | Input     | 32    | å†™åœ°å€                                                           |
| wdata   | Input     | 32    | å†™æ•°æ®                                                           |
| wstrb   | Input     | 4     | bitä¸º1è¡¨ç¤ºå¯¹åº”byteæ•°æ®æœ‰æ•ˆ                                       |
| wready  | Output    | 1     | å‡†å¤‡å¥½æ¥æ”¶å†™æ•°æ®                                                 |
| wvalid  | Input     | 1     | å†™æœ‰æ•ˆ                                                           |
| bresp   | Output    | 2     | å†™æ“ä½œçŠ¶æ€                                                       |
| bvalid  | Output    | 1     | å†™å“åº”æœ‰æ•ˆä¿¡å·                                                   |
| bready  | Input     | 1     | MASTERå‡†å¤‡å¥½æ¥æ”¶å†™å“åº”                                           |

### è¾“å‡ºåˆ°å±å¹•çš„ä¿¡å·

| Signal  | Direction | Width | Description           |
| ------- | --------- | ----- | --------------------- |
| clk_p   | Input     | 1     | åƒç´ æ—¶é’Ÿï¼Œé»˜è®¤æ˜¯25mhz |
| reset_n | Input     | 1     | å¤ä½ä¿¡å·              |
| r       | Output    | 4     | è“è‰²                  |
| g       | Output    | 4     | ç»¿è‰²                  |
| b       | Output    | 4     | è“è‰²                  |
| vsync   | Output    | 1     | å‚ç›´åŒæ­¥              |
| hsycn   | Output    | 1     | æ°´å¹³åŒæ­¥              |
| blank   | Output    | 1     | é»‘å±ä¿¡å·              |

## å…³é”®æ—¶åº

> timing graph

![vga timing](https://s2.loli.net/2023/07/24/NzXkTIdPU56uE3F.png)

TODO: ç”»å¤§æ¦‚çš„æ—¶åºå³å¯
TODO: æ—¶åºåˆ†æï¼Œéœ€è¦è€ƒè™‘æ•°æ®ä» SDRAM è¯»å‡ºçš„æ—¶åº
TODO: æ—¶åºåˆ†æï¼Œéœ€è¦è€ƒè™‘ä½¿ç”¨ AXI4 æ¥å£çš„æ—¶åº

## è¯¦ç»†è®¾è®¡

> æè¿°è¯¥æ¨¡å—å…·ä½“æ€ä¹ˆå®ç°åŠŸèƒ½æè¿°çš„ï¼ŒåŒ…å«å“ªäº›å­æ¨¡å—ï¼Œå„ä¸ªå­æ¨¡å—çš„åŠŸèƒ½æè¿°ã€é¡¶å±‚æ¥å£ã€æ¨¡å—æ¡†å›¾å’Œç”µè·¯å›¾ç­‰ã€‚
> è¦å…·ä½“è¯¦ç»†ï¼Œä»–äººçœ‹åˆ°è¯¥éƒ¨åˆ†åèƒ½å®Œæˆè¯¥æ¨¡å—çš„ RTL ä»£ç å®ç°ã€‚

1. The VGA uses uncached byte accesses to 0xA0000-0xBFFFF
2. VGA has internal registers which can be write or read by the Core, these registers are used for VGA configuration
3. VGA has 256k of video memory, which is composed of 4 bank memory block(64k)

TODO: è¯¦ç»†å†™å‡ºå„ä¸ªæ¨¡å—çš„è®¾è®¡ç»†èŠ‚

ä¸åŒçš„VGAè®¿å­˜æ–¹æ¡ˆï¼š

> CPUéœ€è¦å¾€RAMé‡Œå†™ï¼ŒVGAéœ€è¦ä»RAMé‡Œè¯»å–ï¼Œæ‰€ä»¥éœ€è¦æ§åˆ¶å¥½äºŒè€…å¯¹RAMçš„è®¿é—®

1. é‡‡ç”¨2-port RAM
2. æ—¶é—´å¤ç”¨ï¼ŒRAMçš„é€Ÿåº¦ç¿»å€ï¼Œä»è€Œå¯ä»¥åœ¨ä¸€åŠçš„æ—¶é—´ç”±CPUè®¿é—®ï¼Œåœ¨å¦ä¸€åŠæ—¶é—´ç”±VGAè®¿é—®
3. é‡‡ç”¨Busï¼šVGAå¤„äºvisibleçš„æ—¶é—´æ—¶ï¼ŒVGAè®¿é—®RAMï¼Œå¦åˆ™CPUè®¿é—®RAM(CPUå¿…é¡»åœ¨VGAè®¿é—®RAMçš„æ—¶å€™ï¼Œæš‚åœ)
4. å°†RAMåˆ†ä¸åŒçš„BANKï¼Œå½“VGAè·ŸCPUè®¿é—®ä¸åŒBANKçš„æ—¶å€™ï¼ŒäºŒè€…å¯ä»¥å¹¶è¡Œ

## åŠŸèƒ½åˆ†è§£

> è¯¦ç»†åˆ—å‡ºè¯¥æ¨¡å—çš„åŠŸèƒ½ç‚¹ï¼Œç›®çš„æ˜¯ä¸ºè¯¥æ¨¡å—çš„å•å…ƒæµ‹è¯•ï¼ˆUTï¼‰åšå‡†å¤‡ã€‚
> åŠŸèƒ½ç‚¹åˆ†è§£æ˜¯ä¸ºäº†**é’ˆå¯¹è¯¥æ¨¡å—çš„åŠŸèƒ½ç‚¹è®¾è®¡ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹**ï¼Œå®Œæˆè¯¥æ¨¡å—å•å…ƒæµ‹è¯•åŠŸèƒ½è¦†ç›–ç‡è¦†ç›–ã€‚

VGA è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨æ—¶ï¼Œéœ€è¦å®ç°çš„åŠŸèƒ½ï¼š

1. åœ¨640x480 60Hzçš„è¾“å‡ºåˆ†è¾¨ç‡ä¸‹ï¼š
   1. è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ï¼Œåœ¨æ•´ä¸ªæ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºåŒä¸€å—é¢œè‰²
   2. è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ï¼Œåœ¨æ•´ä¸ªæ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºå½©æ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º
      ![output color strop](https://s2.loli.net/2023/07/25/hbEuYgeNWm8aJfy.png)
   3. è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ï¼Œåœ¨æ•´ä¸ªæ˜¾ç¤ºå™¨ä¸Šé™æ€å›¾ç‰‡
   4. è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ï¼Œåœ¨æ•´ä¸ªæ˜¾ç¤ºå™¨ä¸Šæ–‡å­—
2. è·ŸSDRAMè¯»å–æ•°æ®æ—¶éœ€è¦è€ƒè™‘çš„æƒ…å†µ
3. æ›´æ”¹è¾“å‡ºåˆ†è¾¨ç‡æ—¶éœ€è¦è€ƒè™‘çš„æƒ…å†µ

## ä¸´æ—¶ç–‘é—®

> å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸´æ—¶ç–‘é—®ï¼Œä¾›<u>è®°å½•</u>å’Œ<u>è®¨è®º</u>

- [x] SoC é€Ÿåº¦ vs VGA è¯»å–é€Ÿåº¦ï¼šå¯ä»¥é€šè¿‡ SDRAM å°† SoC è·Ÿ VGA è§£è€¦ï¼Œä»è€Œ VGA åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¸ç”¨ç›´æ¥è·Ÿ SoC äº¤äº’ã€‚  
       ä½†æ˜¯ SoC å¾€ VGA é…ç½®å¯„å­˜å™¨é‡Œå†™å…¥é…ç½®ä¿¡æ¯çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦è€ƒè™‘æ—¶é’Ÿé—®é¢˜ã€‚
- [ ] VGA è·Ÿ SDRAM è”åˆè®¾è®¡ï¼šæ¥å£ã€axi4ã€æ—¶åº
- [ ] VGA è®¾è®¡çš„å…·ä½“ä¸œè¥¿ï¼šè½¯ä»¶å¯åŠ¨ã€VGA åˆå§‹åŒ–ç­‰  
       reset çš„æ—¶å€™ï¼Œéœ€è¦åˆå§‹åŒ– VGA çš„é…ç½®å¯„å­˜å™¨ã€è·Ÿ SDRAM äº¤äº’çš„è¾“å‡ºä¿¡å·å¦‚åœ°å€ä¿¡å·ç­‰
- [ ] è®¾è®¡ã€éªŒè¯çš„å…·ä½“æµç¨‹
- [ ] VGA å¦‚ä½•é€šè¿‡ AXI4 ä¸ SDRAM äº¤äº’ï¼Ÿ
- [ ] SoC å¦‚ä½•ç»™ VGA å¯„å­˜å™¨å†™å…¥æ•°æ®ï¼Œä»è€Œè°ƒæ•´ VGA è¾“å‡ºåˆ†è¾¨ç‡ï¼Œç›¸å…³çš„æ•°æ®é€šè·¯ä»¥åŠæ§åˆ¶ä¿¡å·

### SoC é€Ÿåº¦ vs VGA è¯»å–é€Ÿåº¦

1. SoC ä¼šå°†æ¯å¸§çš„ç”»é¢å­˜å‚¨åˆ° SDRAM ä¸­(å¦‚æœ rgb é¢œè‰²å  4bitsï¼Œåˆ™ 640x480 çš„è¾“å‡ºï¼Œæ¯å¸§ç”»é¢å å¤§æ¦‚ 3.51Mb)
2. åœ¨ SDRAM ä¸­åˆ’åˆ† 2 å—å­˜å‚¨åŒºåŸŸï¼Œä½œä¸º ping pong memory
3. VGA åªéœ€è¦ä» SDRAM ä¸­è¯»å–æ•°æ®å³å¯ï¼Œä¸å— SoC æ—¶é’Ÿçš„å½±å“; VGA åªéœ€è¦å¤„ç†è·Ÿ SDRAM çš„äº¤äº’å³å¯

### VGA è·Ÿ SDRAM è”åˆè®¾è®¡

### VGA è®¾è®¡çš„å…·ä½“ä¸œè¥¿ï¼šè½¯ä»¶å¯åŠ¨ã€VGA åˆå§‹åŒ–ç­‰

### è®¾è®¡ã€éªŒè¯çš„å…·ä½“æµç¨‹

# å‘¨ä¼šè®°å½•

## 2023.07.20 ä¼šè®®çºªè¦

- [ ] SoC é€Ÿåº¦ vs VGA è¯»å–é€Ÿåº¦
- [ ] VGA è·Ÿ SDRAM è”åˆè®¾è®¡
- [ ] VGA è®¾è®¡çš„å…·ä½“ä¸œè¥¿ï¼šè½¯ä»¶å¯åŠ¨ã€VGA åˆå§‹åŒ–ç­‰
- [ ] è®¾è®¡ã€éªŒè¯çš„å…·ä½“æµç¨‹
