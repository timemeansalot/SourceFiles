---
title: c++_memory_partition
date: 2021-03-23 13:49:18
tags: C++
---

C++不同的数据，在内存中的存放位置

<!--more-->

[[_TOC_]]

- 代码区

   程序被操作系统加载到内存时，所有可执行的代码被加载到代码区，也叫代码段，存储程序的代码指令。程序运行时，这段区域数据不可被修改只可以被执行。

- 静态区

   程序中的静态变量、全局变量存放在此区域（初始化的全局变量和静态变量在一块区域）。代码执行期间一直占用内存！

- 堆

   堆是不连续的内存区域，获得的空间比较灵活，也比较大，一般速度比较慢，而且容易产生内存碎片,不过用起来最方便。需要程序员申请的内存空间，空间的释放一般由程序员控制(比如new, delete, malloc, free)。当程序员没有释放该内存空间的时候，程序运行完毕时操作系统会对该内存空间进行回收。

- 栈

   栈是一块连续的内存的区域，一般栈的大小都是预先设置好的，如果申请的空间超过栈的剩余空间时，将提示overflow。存放的通常是变量通常是局部变量、函数参数等。

- 文字常量区

   常量字符串就是放在这里的。 程序结束后由系统释放。

- bss段

   定义而没有赋初值的全局变量和静态变量,放在这个区域，通常只是记录变量名和大小，相当于一个占位符。

 一个程序本质上都是由`.bss`段、`.data`段、`.text`段三个组成的。`.data`段包含三个部分：heap(堆)、stack(栈)和静态数据区。`.text`段存放代码区。`.bss` 里面装载了未被初始化的数据；如图：

![image-20210323142417299](https://i.loli.net/2021/03/23/mABKcR7lpUfrLjE.png)



example: 

```c++
int a = 0; //全局初始化区（静态区） 
char *p1;  //全局未初始化区 （BSS段）
int main() 
{ 
    int b; //栈 
    char s[] = "abc"; //栈 
    char *p2; //栈 
    char *p3 = "123456"; //123456/0在常量区，p3在栈上。 
    static int c = 0； //全局（静态）初始化区 （静态区）
    p1 = (char *)malloc(10); //分配得10和20字节的区域就在堆区。 
    p2 = (char *)malloc(20); 
    strcpy(p1, "123456");  
    //123456/0放在常量区，编译器可能会将它与p3所指向的"123456"优化成一块。
    return 0;
}
```

